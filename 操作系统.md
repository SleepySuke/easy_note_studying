# 操作系统

## 介绍

**什么是操作系统：**

控制角度

![](assets/OS知识1.png)

资源分配角度

![](assets/OS知识2.png)

![](assets/OS知识3.png)

操作系统层次

![](assets/OS知识4.png)

![](assets/OS知识5.png)

![](assets/OS知识6.png)

![](assets/OS知识7.png)

并发和并行的区别：

并发：在一段时间内，有多个程序可以同时运行

并行：在一个时间点上，可以有多个程序运行(一般是有多个CPU即可跑程序)

内核特征：

![](assets/OS知识8.png)

![](assets/OS知识10.png)

![](assets/OS知识11.png)

**操作系统实例：**

1.UNIX操作系统

2.Linux操作系统

3.Windows操作系统

![](assets/OS知识12.png)

## 启动、中断、异常以及系统调用

![](assets/OS知识13.png)

DISK：存方OS

BIOS：基于I/O处理系统

Bootloader：加载OS

![](assets/OS知识14.png)

![](assets/OS知识15.png)

![](assets/OS知识16.png)

![](assets/OS知识17.png)

![](assets/OS知识18.png)

**中断过程：**

![](assets/OS知识19.png)

![](assets/OS知识20.png)

**异常过程：**

![](assets/OS知识21.png)

**系统调用：**

![](assets/OS知识22.png)

当app访问系统调用接口，此时会出现一个用户态到内核态的转换

用户态：app在执行过程中CPU所处的一个状态，此时特权指令低，无法访问io等功能，无法控制整个计算机

内核态：CPU处于的最高级别状态，可以访问任何指令

![](assets/OS知识24.png)

## 计算机体系结构及内存分层体系

![](assets/OS知识25.png)

计算机基本硬件结构：

![](assets/OS知识26.png)

内存分层：

![](assets/OS知识27.png)

操作系统的四大目标：

![](assets/OS知识28.png)

P1正在运行，P2、P3、P4正在等待

操作系统中管理内存的不同方法：

![](assets/OS知识29.png)

![](assets/OS知识30.png)

地址空间&地址生成：

1. 地址空间定义
2. 地址生成
3. 地址安全检查

![](assets/OS知识31.png)

![](assets/OS知识32.png)

逻辑地址与物理地址：

![](assets/OS知识33.png)

此时他们两个之间存在一个映射表

![](assets/OS知识34.png)

访问的过程

**连续内存分配：**

![](assets/OS知识35.png)

![](assets/OS知识36.png)

![](assets/OS37.png)

首次适配：

![](assets/OS38.png)

基本原理：

![](assets/OS39.png)

优势：

简单、易于产生更大空闲块，向着地址空间的结尾

缺点：

会产生外部碎片（第一个空闲的块寻找到之后，下次再去寻找的时候可能会去寻找另一个空闲块，此时原来的第一个空闲块有的空间并未使用，导致了外部碎片）

最优适配（根据块的大小进行排序）：

![](assets/OS41.png)

![](assets/OS40.png)

最差适配（根据块的大小进行排序）：

![](assets/OS42.png)

![](assets/OS43.png)

压缩式碎片整理：

紧凑式算法（conpaction）

![](assets/OS44.png)

![](assets/OS45.png)

把每个占用的线程中的空闲块覆盖掉，程序往上挪，此时空闲块均在下方，如图所示的变化

挪动时间点：不可在程序运行时进行挪动，否则会出现找不到，然后可以在程序停止的时候进行挪动，挪动即进行拷贝数据

但是开销会很大

交换式碎片整理（换入换出）：

![](assets/OS46.png)

如果主存中没有够多的空间，此时可以将等待的进程的空间导入到虚拟内存中即硬盘上

## 非连续内存分配

为什么需要非连续内存？

因为连续内存分配存在以下缺点：

- 分配给一个程序的物理内存是连续的
- 内存利用率较低
- 有外碎片、内碎片问题

内碎片：分配给了程序，但未被实际使用的碎片

外碎片：未分配给程序的碎片

非连续内存分配优点：

- 一个程序的物理地址空间是非连续的
- 更好的内存使用和管理
- 允许共享代码与数据
- 支持动态加载和动态链接

缺点：

如何建立虚拟地址和物理地址之间的转换

软件方案、硬件方案

硬件方案：

1. 分段
2. 分页

分段管理机制：程序的分段地址空间、分段寻址方案

分段能够更好的分离和共享

![](assets/os47.png)

![](assets/os48.png)

分段寻址方案：

![](assets/os49.png)

![](assets/os50.png)

limit应该是限制

